<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nebula Idle - Modular V13</title>
    <link href="https://fonts.googleapis.com/css2?family=Creepster&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            font-family: 'Creepster', cursive;
            background: radial-gradient(circle at 50% 50%, #0a0015 0%, #000000 70%);
            color: #d0c0ff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><circle cx="10" cy="10" r="1" fill="%23ffffff" opacity="0.3"/><circle cx="50" cy="30" r="1.5" fill="%23ffffff" opacity="0.2"/><circle cx="80" cy="70" r="1" fill="%23ffffff" opacity="0.25"/></svg>') repeat;
            opacity: 0.12;
            pointer-events: none;
            animation: slowDrift 120s linear infinite;
        }

        @keyframes slowDrift {
            from { background-position: 0 0; }
            to { background-position: 100px 100px; }
        }

        #topBar {
            padding: 15px;
            background: rgba(10, 0, 30, 0.85);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
            border-bottom: 2px solid #aa00ff;
            box-shadow: 0 4px 20px rgba(170, 0, 255, 0.3);
        }

        .stats {
            font-size: 18px;
            font-weight: bold;
            text-shadow: 0 0 12px #aa00ff;
            margin: 8px 0;
        }

        button {
            background: linear-gradient(135deg, #6a00ff, #c300ff);
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            margin: 6px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 15px rgba(106, 0, 255, 0.6);
        }

        button:hover {
            transform: scale(1.08);
            box-shadow: 0 0 30px rgba(195, 0, 255, 0.9);
        }

        .tabButton.active {
            background: linear-gradient(135deg, #c300ff, #ff00aa);
            box-shadow: 0 0 25px #ff00aa;
        }

        #tabs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            padding: 10px;
        }

        #content {
            padding: 20px;
        }

        .panel {
            max-width: 800px;
            margin: 0 auto;
        }

        .item {
            background: rgba(20, 0, 50, 0.7);
            border: 1px solid #6a00ff;
            border-radius: 12px;
            padding: 12px;
            margin: 10px 0;
            box-shadow: 0 0 15px rgba(106, 0, 255, 0.4);
        }

        .smallBtn {
            background: #00d4ff;
            color: black;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            margin: 4px;
            cursor: pointer;
        }

        #chestContainer {
            text-align: center;
            margin: 20px 0;
        }

        .chest-icon {
            font-size: 80px;
            cursor: pointer;
            transition: all 0.4s;
            filter: drop-shadow(0 0 15px #ffd700);
        }

        .chest-icon:hover {
            transform: scale(1.15) rotate(10deg);
            filter: drop-shadow(0 0 30px #ff4500);
        }

        .chest-opening {
            animation: chestEpicOpen 1.2s ease-out;
        }

        @keyframes chestEpicOpen {
            0% { transform: scale(1) rotateY(0deg); }
            40% { transform: scale(1.4) rotateY(180deg); filter: brightness(2) drop-shadow(0 0 60px #ff00ff); }
            70% { transform: scale(1.6) rotateY(360deg); filter: brightness(3) drop-shadow(0 0 100px #00ff88); }
            100% { transform: scale(1) rotateY(720deg); filter: brightness(1); }
        }

        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #ffd700;
            border-radius: 50%;
            pointer-events: none;
            animation: burst 0.9s ease-out forwards;
        }

        @keyframes burst {
            0% { transform: translate(0, 0) scale(0.5); opacity: 1; }
            100% { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; }
        }

        #tutorialPanel {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.92);
            color: white;
            padding: 30px;
            overflow-y: auto;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        #tutorialPanel button {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 20px;
        }
    </style>
</head>
<body>

<div id="tutorialPanel">
    <h2>HoÅŸ Geldin Nebula'ya!</h2>
    <p style="font-family: Arial; max-width: 600px; line-height: 1.6;">
        Bu idle oyun, gÃ¼Ã§ topla, item yÃ¼kselt, rebirth yapÄ±p sonsuza kadar ilerle!<br><br>
        1. Ortadaki bÃ¼yÃ¼k sandÄ±ÄŸa tÄ±kla (para harca item Ã§Ä±kar).<br>
        2. Ã‡Ä±kan item'larÄ± tak, gÃ¼Ã§ artsÄ±n â†’ pasif para gelsin.<br>
        3. Item'larÄ± yÃ¼kselt veya sat.<br>
        4. GÃ¼Ã§ biriktir, rebirth yap â†’ Nebula puanÄ± kazan (kalÄ±cÄ± gÃ¼Ã§ artÄ±ÅŸÄ±).<br>
        5. Rebirth Shop'ta Nebula ile kalÄ±cÄ± upgrade al.<br>
        6. Boss yen, achievement tamamla, gÃ¼nlÃ¼k Ã¶dÃ¼l topla.<br><br>
        Arka planda bÄ±rak, para biriksin. EÄŸlen!
    </p>
    <button onclick="document.getElementById('tutorialPanel').style.display='none'">BaÅŸla!</button>
</div>

<div id="topBar">
    <div class="stats">ğŸ’° Para: <span id="money">1000</span></div>
    <div class="stats">âš¡ GÃ¼Ã§: <span id="power">0</span></div>
    <div class="stats">ğŸŒŒ Rebirth: <span id="rebirthLevel">0</span> | Nebula: <span id="nebulaPoints">0</span></div>
    <div class="stats" id="equippedInfo">TakÄ±lÄ±: Yok</div>

    <div id="chestContainer">
        <div class="chest-icon" id="chestIcon">ğŸ—ï¸</div>
    </div>

    <div style="text-align:center; margin:10px;">
        <button id="musicBtn">ğŸµ MÃ¼zik</button>
        <button id="rebirthBtn">ğŸ”„ Rebirth</button>
        <button id="resetBtn">ğŸ’€ SÄ±fÄ±rla</button>
        <button id="dailyBtn">ğŸ“… GÃ¼nlÃ¼k</button>
    </div>
</div>

<div id="tabs">
    <button class="tabButton active" data-tab="inventory">Envanter</button>
    <button class="tabButton" data-tab="shop">MaÄŸaza</button>
    <button class="tabButton" data-tab="rebirthShop">Rebirth Shop</button>
    <button class="tabButton" data-tab="achievements">BaÅŸarÄ±lar</button>
</div>

<div id="content">
    <div id="inventoryPanel" class="tabContent panel active">
        <h2>Envanter</h2>
        <div id="inventoryList"></div>
    </div>

    <div id="shopPanel" class="tabContent panel">
        <h2>MaÄŸaza</h2>
        <div id="shopList"></div>
    </div>

    <div id="rebirthShopPanel" class="tabContent panel">
        <h2>Rebirth Shop</h2>
        <div id="rebirthShopList"></div>
    </div>

    <div id="achievementsPanel" class="tabContent panel">
        <h2>BaÅŸarÄ±lar</h2>
        <div id="achievementsList"></div>
    </div>
</div>

<audio id="bgm" loop preload="auto">
    <source src="YOU CAN ASK THE FLOWERSYOU CAN ASK THE FLOWERS (HORROR MIX)(_6TMiEoJeZ9U_).m4a" type="audio/mp4">
</audio>

<script>
// ========================
// MODÃœLER YAPILANDIRMA
// ========================

// 1. State (tek merkezÃ® obje)
const gameState = {
    money: 1000,
    power: 0,
    rebirthLevel: 0,
    nebulaPoints: 0,
    inventory: [],
    equipped: {},
    musicOn: false,
    lastSave: Date.now(),
    lastDailyClaim: 0,
    dailyStreak: 0
};

// 2. DOM Cache & Helper
const $ = id => document.getElementById(id);
const $$ = selector => document.querySelectorAll(selector);

const elements = {
    money: $('money'),
    power: $('power'),
    rebirthLevel: $('rebirthLevel'),
    nebulaPoints: $('nebulaPoints'),
    equippedInfo: $('equippedInfo'),
    chestIcon: $('chestIcon'),
    inventoryList: $('inventoryList'),
    shopList: $('shopList'),
    rebirthShopList: $('rebirthShopList'),
    achievementsList: $('achievementsList'),
    bgm: $('bgm')
};

// 3. Utility Functions
function rand(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function rollRarity() {
    const r = Math.random();
    if (r < 0.6) return 'common';
    if (r < 0.85) return 'rare';
    if (r < 0.97) return 'epic';
    return 'legendary';
}

function calculatePower() {
    let total = 0;
    Object.values(gameState.equipped).forEach(id => {
        const item = gameState.inventory.find(i => i.id === id);
        if (item) total += item.power * item.level;
    });
    gameState.power = total;
}

function formatNumber(num) {
    return num.toLocaleString('tr-TR');
}

// 4. Save / Load
function saveGame() {
    gameState.lastSave = Date.now();
    localStorage.setItem('nebulaV13', JSON.stringify(gameState));
}

function loadGame() {
    const saved = localStorage.getItem('nebulaV13');
    if (saved) {
        Object.assign(gameState, JSON.parse(saved));
    }
    // Offline progress (basit)
    const offlineMin = Math.floor((Date.now() - gameState.lastSave) / 60000);
    gameState.money += offlineMin * Math.floor(gameState.power / 10);
    calculatePower();
}

// 5. UI Update ModÃ¼lleri
function updateMoney() {
    elements.money.textContent = formatNumber(gameState.money);
}

function updatePower() {
    elements.power.textContent = formatNumber(gameState.power);
}

function updateRebirth() {
    elements.rebirthLevel.textContent = gameState.rebirthLevel;
    elements.nebulaPoints.textContent = formatNumber(gameState.nebulaPoints);
}

function updateEquipped() {
    let text = "TakÄ±lÄ±: ";
    let has = false;
    Object.entries(gameState.equipped).forEach(([slot, id]) => {
        const item = gameState.inventory.find(i => i.id === id);
        if (item) {
            text += `${slot}: ${item.name} `;
            has = true;
        }
    });
    elements.equippedInfo.textContent = has ? text : "TakÄ±lÄ±: Yok";
}

function updateInventory() {
    const list = elements.inventoryList;
    list.innerHTML = '';
    gameState.inventory.forEach(item => {
        const div = document.createElement('div');
        div.className = `item ${item.rarity}`;
        div.innerHTML = `<b>${item.name}</b><br>GÃ¼Ã§: ${item.power} | Seviye: ${item.level}`;
        const equipBtn = document.createElement('button');
        equipBtn.className = 'smallBtn';
        equipBtn.textContent = 'Tak';
        equipBtn.onclick = () => {
            gameState.equipped[item.rarity || 'default'] = item.id;
            updateUI();
            saveGame();
        };
        div.appendChild(equipBtn);
        list.appendChild(div);
    });
}

function updateShop() {
    const list = elements.shopList;
    list.innerHTML = '';
    // Ã–rnek maÄŸaza item'larÄ± (daha fazla eklenebilir)
    const shopItems = [
        {name: "Garantili Rare SandÄ±k", cost: 500, action: () => buyChest(true, 'rare')},
        {name: "Epic Booster", cost: 2000, action: () => { gameState.nebulaPoints += 20; updateUI(); saveGame(); }},
        {name: "Para Paketi (5k)", cost: 1000, action: () => { gameState.money += 5000; updateUI(); saveGame(); }}
    ];
    shopItems.forEach(item => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `<b>${item.name}</b> - ${formatNumber(item.cost)} ğŸ’°`;
        const btn = document.createElement('button');
        btn.className = 'smallBtn';
        btn.textContent = 'SatÄ±n Al';
        btn.onclick = () => {
            if (gameState.money >= item.cost) {
                gameState.money -= item.cost;
                item.action();
                updateUI();
                saveGame();
            } else alert("Para yetmez!");
        };
        div.appendChild(btn);
        list.appendChild(div);
    });
}

function updateRebirthShop() {
    // Rebirth shop burada olacak (daha sonra geniÅŸletilebilir)
    const list = elements.rebirthShopList;
    list.innerHTML = '<p>Rebirth puanÄ±nla kalÄ±cÄ± upgrade'ler yakÄ±nda eklenecek!</p>';
}

function updateAchievements() {
    const list = elements.achievementsList;
    list.innerHTML = '<p>BaÅŸarÄ±lar yakÄ±nda eklenecek!</p>';
}

function updateUI() {
    updateMoney();
    updatePower();
    updateRebirth();
    updateEquipped();
    updateInventory();
    updateShop();
    updateRebirthShop();
    updateAchievements();
}

// 6. Chest & Animasyon
function openChest() {
    const cost = 100 + Math.floor(gameState.power / 10);
    if (gameState.money < cost) return alert(`Para yetmez! (${cost} lazÄ±m)`);
    gameState.money -= cost;

    const rarity = rollRarity();
    const item = {
        id: Date.now(),
        name: rarity.toUpperCase() + " Item",
        rarity,
        power: rarity === 'common' ? rand(5,15) : rarity === 'rare' ? rand(15,30) : rarity === 'epic' ? rand(30,60) : rand(60,100),
        level: 1
    };

    gameState.inventory.push(item);
    animateChestOpen();
    updateUI();
    saveGame();
}

function animateChestOpen() {
    const icon = $('chestIcon');
    icon.classList.add('chest-opening');
    setTimeout(() => icon.classList.remove('chest-opening'), 1200);

    const container = $('chestContainer');
    for (let i = 0; i < 30; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = '50%';
        p.style.top = '50%';
        p.style.setProperty('--dx', (Math.random() - 0.5) * 200 + 'px');
        p.style.setProperty('--dy', (Math.random() - 0.5) * 200 + 'px');
        p.style.background = ['#ffd700', '#ff4500', '#ff00ff', '#00ff88'][rand(0,3)];
        container.appendChild(p);
        setTimeout(() => p.remove(), 1200);
    }

    if (navigator.vibrate) navigator.vibrate([50, 30, 50]);
}

// 7. Event Bindings
function bindEvents() {
    $('chestIcon').addEventListener('click', openChest);
    $('musicBtn').addEventListener('click', () => {
        gameState.musicOn = !gameState.musicOn;
        const audio = $('bgm');
        if (gameState.musicOn) {
            audio.play().catch(() => alert("MÃ¼zik iÃ§in ekrana dokun!"));
        } else {
            audio.pause();
        }
    });
    $('rebirthBtn').addEventListener('click', () => alert("Rebirth yakÄ±nda!"));
    $('resetBtn').addEventListener('click', () => {
        if (confirm("TÃ¼m ilerleme silinecek!")) {
            localStorage.clear();
            location.reload();
        }
    });
    $('dailyBtn').addEventListener('click', () => alert("GÃ¼nlÃ¼k Ã¶dÃ¼l yakÄ±nda!"));

    $$('.tabButton').forEach(btn => {
        btn.addEventListener('click', () => {
            $$('.tabContent').forEach(p => p.classList.remove('active'));
            $$('.tabButton').forEach(b => b.classList.remove('active'));
            $(btn.dataset.tab + 'Panel').classList.add('active');
            btn.classList.add('active');
        });
    });
}

// 8. Init
document.addEventListener('DOMContentLoaded', () => {
    loadGame();
    updateUI();
    bindEvents();

    // Auto save
    setInterval(() => {
        saveGame();
    }, 10000);

    // Tutorial auto close
    setTimeout(() => {
        $('tutorialPanel').style.display = 'none';
    }, 30000);
});
</script>
</body>
</html>