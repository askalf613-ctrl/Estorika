<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nebula Idle - Horror Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    font-family:'Creepster', cursive;
    background: linear-gradient(to bottom, #0b001a, #000814);
    color:#e0e0ff;
    overflow-x:hidden;
}

#topBar{
    padding:15px;
    background:rgba(20,0,40,0.8);
    position:sticky;
    top:0;
    z-index:10;
    backdrop-filter: blur(5px);
}

#money, #power, #nebulaPoints, #equipped { font-size:20px; font-weight:bold; text-shadow:0 0 10px #ff00ff; }

button{
    background:#8b00ff;
    border:2px solid #ff00ff;
    padding:12px;
    border-radius:12px;
    font-weight:bold;
    margin:8px 0;
    width:100%;
    color:white;
    cursor:pointer;
    transition:all 0.3s;
    box-shadow:0 0 15px #8b00ff;
}

button:hover { background:#ff00ff; box-shadow:0 0 25px #ff00ff; transform:scale(1.05); }

#inventoryPanel{ padding:15px; }

.item{
    background:rgba(30,0,60,0.7);
    padding:12px;
    border-radius:12px;
    margin-bottom:12px;
    border:1px solid #8b00ff;
    box-shadow:0 0 15px rgba(139,0,255,0.5);
    transition:all 0.3s;
}

.item:hover { transform:scale(1.03); box-shadow:0 0 30px #ff00ff; }

.smallBtn{
    margin:5px 5px 0 0;
    padding:8px 12px;
    font-size:14px;
    width:auto;
}

/* Rarity */
.common{ color:#aaa; text-shadow:0 0 5px #aaa; }
.rare{ color:#00bfff; text-shadow:0 0 10px #00bfff; }
.epic{ color:#c300ff; text-shadow:0 0 15px #c300ff; }
.legendary{ color:#ffea00; text-shadow:0 0 20px #ffea00; }

/* Animasyonlar */
@keyframes pulse { 0% { opacity:0.8; } 50% { opacity:1; } 100% { opacity:0.8; } }
#topBar { animation:pulse 4s infinite; }

.shake { animation:shake 0.6s; }

/* Nebula arka plan efekti */
body::before {
    content:"";
    position:fixed;
    top:0; left:0; right:0; bottom:0;
    background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><circle cx="10" cy="10" r="1" fill="white"/><circle cx="50" cy="30" r="2" fill="white"/><circle cx="80" cy="70" r="1.5" fill="white"/></svg>') repeat;
    opacity:0.15;
    pointer-events:none;
}
</style>
</head>

<body>

<audio id="bgm" loop>
  <source src="YOU CAN ASK THE FLOWERSYOU CAN ASK THE FLOWERS (HORROR MIX)(_6TMiEoJeZ9U_).m4a" type="audio/mp4">
</audio>

<div id="topBar">
    <div id="money">Para: 0</div>
    <div id="power">Güç: 0</div>
    <div id="nebulaPoints">Nebula Puan: 0</div>
    <div id="equipped">Takılı: Yok</div>

    <button id="chestBtn" onclick="openChest()">Karanlık Sandık Aç (100)</button>
    <button onclick="toggleMusic()">Müzik Aç/Kapat</button>
    <button onclick="prestige()">Prestige (Yeniden Doğuş)</button>
    <button onclick="resetGame()">Tam Sıfırla</button>
</div>

<div id="inventoryPanel">
    <h2>Lanetli Envanter</h2>
    <div id="inventoryList"></div>
</div>

<script>
/* DATA */
let money = 200;
let inventory = [];
let equipped = null;
let nebulaPoints = 0;
let musicOn = false;

/* Horror temalı isimler */
const itemNames = {
    common: ["Paslı Lanet Kılıcı", "Çürük Kemik Kalkan", "Kanlı Çizmeler", "Kırık Yüzük"],
    rare: ["Gölge Bıçağı", "Hayalet Kalkan", "Gece Botları", "Kabus Yüzüğü"],
    epic: ["Kan Kırmızısı Kılıç", "Lanetli Zırh", "Uçurum Botu", "Şeytan Yüzüğü"],
    legendary: ["Cehennem Kılıcı", "Abyss Kalkanı", "Karanlık Işık Botu", "Ebedi Lanet Yüzüğü"]
};

/* LOAD */
const save = JSON.parse(localStorage.getItem("nebulaSave"));
if(save){
    money = save.money || 200;
    inventory = save.inventory || [];
    equipped = save.equipped;
    nebulaPoints = save.nebulaPoints || 0;
}

/* SAVE */
function saveGame(){
    localStorage.setItem("nebulaSave", JSON.stringify({money, inventory, equipped, nebulaPoints}));
}

/* RARITY */
function rollRarity(){
    let r = Math.random()*100;
    if(r < 55) return "common";
    if(r < 80) return "rare";
    if(r < 95) return "epic";
    return "legendary";
}

function rarityPower(r){
    if(r=="common") return rand(8,15);
    if(r=="rare") return rand(15,30);
    if(r=="epic") return rand(30,55);
    return rand(55,90);
}

function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }

/* CHEST */
function openChest(){
    if(money < 100) return alert("Karanlık enerji yetmez!");
    money -= 100;

    const rarity = rollRarity();
    const names = itemNames[rarity];
    const name = names[rand(0, names.length-1)] + " (" + rarity.toUpperCase() + ")";

    const item = {
        id: Date.now() + Math.random(),
        name,
        rarity,
        power: rarityPower(rarity),
        level: 1
    };

    inventory.push(item);
    if(navigator.vibrate) navigator.vibrate([100,50,100]);

    document.getElementById("chestBtn").classList.add("shake");
    setTimeout(()=>document.getElementById("chestBtn").classList.remove("shake"), 600);

    render();
    saveGame();
}

/* EQUIP / SELL / UPGRADE */
function equipItem(id){ equipped = id; render(); saveGame(); }

function sellItem(id){
    const item = inventory.find(i=>i.id===id);
    if(!item) return;
    const sellPrice = Math.floor(item.power * 8 * item.level);
    money += sellPrice;
    alert(`${item.name} kurban edildi, ${sellPrice} karanlık para kazandın!`);
    if(equipped === id) equipped = null;
    inventory = inventory.filter(i=>i.id!==id);
    render(); saveGame();
}

function upgradeItem(id){
    const item = inventory.find(i=>i.id===id);
    const cost = Math.floor(item.level * 60 * Math.log(item.level + 1));
    if(money < cost) return alert("Karanlık enerji yetmez!");
    money -= cost;
    item.level++;
    item.power += rand(3,7);
    render(); saveGame();
}

/* POWER + MULTIPLIER */
function getPower(){
    if(!equipped) return 0;
    const item = inventory.find(i=>i.id===equipped);
    if(!item) return 0;
    const base = item.power * item.level;
    return Math.floor(base * (1 + nebulaPoints * 0.05));
}

/* PASIF GELIR */
function passiveIncome(){
    const income = Math.floor(getPower() / 8);
    if(income > 0){
        money += income;
        render();
    }
}

/* PRESTIGE */
function prestige(){
    if(inventory.length > 0 || money < 500) return alert("Daha fazla güç topla! (En az 500 para + envanter boşalt)");
    if(!confirm("Tüm eşyalar ve para sıfırlanacak, Nebula Puanı kazanacaksın. Emin misin?")) return;

    const prestigeGain = Math.floor(Math.sqrt(money / 100) + inventory.length * 2);
    nebulaPoints += prestigeGain;
    money = 200;
    inventory = [];
    equipped = null;
    alert(`Prestige tamam! +${prestigeGain} Nebula Puanı kazandın. Güç çarpanın arttı!`);
    render(); saveGame();
}

/* RENDER */
function render(){
    document.getElementById("money").innerText = `Para: ${money}`;
    document.getElementById("power").innerText = `Güç: ${getPower()}`;
    document.getElementById("nebulaPoints").innerText = `Nebula Puan: ${nebulaPoints}`;
    const eq = inventory.find(i=>i.id===equipped);
    document.getElementById("equipped").innerText = "Takılı: " + (eq ? eq.name + " +" + eq.level : "Yok");

    const list = document.getElementById("inventoryList");
    list.innerHTML = "";
    inventory.forEach(item=>{
        const div = document.createElement("div");
        div.className = `item ${item.rarity}`;
        div.innerHTML = `<b>${item.name}</b><br>Güç: ${item.power} | Lv: ${item.level}<br>`;

        const eqBtn = document.createElement("button"); eqBtn.className="smallBtn"; eqBtn.innerText="Tak"; eqBtn.onclick=()=>equipItem(item.id);
        const upBtn = document.createElement("button"); upBtn.className="smallBtn"; upBtn.innerText=`Yükselt (${Math.floor(item.level * 60 * Math.log(item.level + 1))})`; upBtn.onclick=()=>upgradeItem(item.id);
        const sellBtn = document.createElement("button"); sellBtn.className="smallBtn"; sellBtn.innerText="Kurban Et"; sellBtn.onclick=()=>sellItem(item.id);

        div.append(eqBtn, upBtn, sellBtn);
        list.appendChild(div);
    });
}

/* RESET */
function resetGame(){
    if(confirm("HER ŞEY silinecek, nebula puanları dahil!")) {
        localStorage.removeItem("nebulaSave");
        location.reload();
    }
}

/* MUSIC */
function toggleMusic(){
    const m = document.getElementById("bgm");
    if(!musicOn) m.play().catch(e=>console.log("Müzik oynatma hatası:",e));
    else m.pause();
    musicOn = !musicOn;
}

/* START */
render();
setInterval(passiveIncome, 1000);
setInterval(saveGame, 15000);
</script>

</body>
</html>