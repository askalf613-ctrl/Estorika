<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nebula Idle - Rebirth Ultimate V5</title>
<link href="https://fonts.googleapis.com/css2?family=Creepster&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
<link rel="manifest" href="data:application/manifest+json,{
  'name': 'Nebula Idle',
  'short_name': 'Nebula',
  'start_url': '.',
  'display': 'standalone',
  'background_color': '#0b001a',
  'theme_color': '#ff00ff'
}">

<style>
body{
    margin:0;
    font-family:'Creepster', cursive;
    background: linear-gradient(45deg, #0b001a, #000814, #1a0033, #330066);
    background-size: 400% 400%;
    animation: nebulaBg 25s ease infinite;
    color:#e0e0ff;
    overflow-x:hidden;
}

@keyframes nebulaBg {
    0%,100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

#topBar{
    padding:20px;
    background:rgba(20,0,40,0.95);
    position:sticky;
    top:0;
    z-index:100;
    backdrop-filter: blur(15px);
    border-bottom: 3px solid #ff00ff;
    box-shadow: 0 0 50px rgba(255,0,255,0.3);
}

.stats { 
    font-size:20px; 
    font-weight:bold; 
    text-shadow:0 0 15px #ff00ff; 
    margin-bottom:12px; 
}

button{
    background:linear-gradient(45deg, #8b00ff, #ff00ff);
    border:2px solid #ff00ff;
    padding:14px 18px;
    border-radius:18px;
    font-family:'Creepster', cursive;
    font-weight:bold;
    margin:8px 6px;
    color:white;
    cursor:pointer;
    transition:all 0.4s ease;
    box-shadow:0 0 25px rgba(139,0,255,0.7);
    min-width:130px;
    position:relative;
    overflow:hidden;
}

button::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s;
}

button:hover::before { left: 100%; }
button:hover { 
    background:linear-gradient(45deg, #ff00ff, #8b00ff);
    box-shadow:0 0 50px #ff00ff;
    transform:scale(1.1) rotate(3deg);
}

button:disabled { 
    opacity:0.4; 
    cursor:not-allowed; 
    transform:none; 
    box-shadow:none;
}

.tabButton.active { 
    background:linear-gradient(45deg, #ff1493, #ff69b4);
    box-shadow:0 0 60px #ff1493; 
}

#tabs { 
    display:flex; 
    flex-wrap:wrap; 
    justify-content:center; 
    gap:12px; 
    margin:15px 0; 
}

#content { padding:25px; min-height:100vh; }

.tabContent { display:none; }
.tabContent.active { display:block; }

.panel {
    max-width:700px;
    margin:0 auto;
}

.item, .shopItem, .rebirthItem, .upgradeItem {
    background:rgba(30,0,60,0.85);
    padding:18px;
    border-radius:18px;
    margin-bottom:18px;
    border:2px solid #8b00ff;
    box-shadow:0 0 30px rgba(139,0,255,0.5);
    transition:all 0.4s ease;
    position:relative;
}

.item:hover, .shopItem:hover, .rebirthItem:hover, .upgradeItem:hover { 
    transform:scale(1.06) rotate(1deg); 
    box-shadow:0 0 60px #ff00ff; 
    border-color:#ff00ff;
}

.achievement {
    background:rgba(0,60,0,0.85);
    border:2px solid #00ff88;
}

.achievement.achieved {
    background:rgba(0,120,0,0.95);
    box-shadow:0 0 40px #00ff88;
    animation: glow 2s infinite;
}

@keyframes glow { 0%,100%{box-shadow:0 0 40px #00ff88;} 50%{box-shadow:0 0 60px #00ff88, 0 0 80px #00ff88;} }

.smallBtn{
    margin:6px 6px 0 0;
    padding:10px 14px;
    font-size:14px;
    border-radius:10px;
    width:auto;
    font-family:Arial, sans-serif;
    background:#22d3ee;
    border:none;
    color:black;
    font-weight:bold;
}

.smallBtn:hover { background:#06b6d4; transform:scale(1.05); }

/* Rarity */
.common  { color:#ccc;    text-shadow:0 0 8px #ccc; }
.rare    { color:#00bfff; text-shadow:0 0 18px #00bfff; }
.epic    { color:#c300ff; text-shadow:0 0 25px #c300ff; }
.legendary { color:#ffea00;text-shadow:0 0 35px #ffea00; }
.mythic  { color:#ff0000; text-shadow:0 0 50px #ff0000, 0 0 70px #ff0000; }

/* Shake */
@keyframes shake {
    0%,100%{transform:translate(1px,1px)rotate(0deg);}
    10%{transform:translate(-1px,-2px)rotate(-1deg);}
    20%{transform:translate(-3px,0px)rotate(1deg);}
    30%{transform:translate(3px,2px)rotate(0deg);}
    40%{transform:translate(1px,-1px)rotate(1deg);}
    50%{transform:translate(-1px,2px)rotate(-1deg);}
    60%{transform:translate(-3px,1px)rotate(0deg);}
    70%{transform:translate(3px,1px)rotate(-1deg);}
    80%{transform:translate(-1px,-1px)rotate(1deg);}
    90%{transform:translate(1px,2px)rotate(0deg);}
}

.shake { animation:shake 0.8s cubic-bezier(.36,.07,.19,.97) both; }

.pulse { animation:pulse 2s infinite; }
@keyframes pulse { 0%{opacity:0.7;transform:scale(1);}50%{opacity:1;transform:scale(1.05);}100%{opacity:0.7;transform:scale(1);} }

/* Yƒ±ldƒ±zlar & Nebula */
body::before {
    content:"";
    position:fixed;top:0;left:0;right:0;bottom:0;
    background-image: 
        radial-gradient(2px 2px at 20px 30px, #fff, transparent),
        radial-gradient(3px 3px at 80px 70px, rgba(255,255,255,0.9), transparent),
        radial-gradient(1.5px 1.5px at 120px 40px, #fff, transparent),
        radial-gradient(2px 2px at 200px 90px, rgba(139,0,255,0.6), transparent);
    background-repeat:repeat;
    background-size:250px 120px;
    opacity:0.4;
    pointer-events:none;
    animation: stars 60s linear infinite;
}
@keyframes stars { from{transform:translateX(0) translateY(0);} to{transform:translateX(-100px) translateY(20px);} }

.progressBar {
    width:100%; height:20px; background:rgba(0,0,0,0.5); border-radius:10px; overflow:hidden; margin:10px 0;
}
.progressFill { height:100%; background:linear-gradient(90deg, #ff00ff, #00ff88); transition:width 0.5s; border-radius:10px; }

/* Rebirth Shop Optimizasyonu */
#rebirthShopList {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}

.rebirthItem {
    position: relative;
}

.rebirthItem p {
    font-size: 14px;
    font-family: Arial, sans-serif;
    margin: 10px 0;
    color: #d1d5db;
}

.rebirthItem .progressBar {
    height: 10px;
    margin: 5px 0;
}

.rebirthItem button {
    width: 100%;
    margin-top: 10px;
    font-family: Arial, sans-serif;
}

/* Tooltip */
.rebirthItem:hover::after {
    content: attr(data-desc);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.8);
    padding: 10px;
    border-radius: 10px;
    width: 200px;
    font-size: 12px;
    color: white;
    text-align: center;
    z-index: 10;
    pointer-events: none;
}

/* G√ºnl√ºk √ñd√ºller */
#dailyRewardsPanel {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(30,0,60,0.9);
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 0 50px #ff00ff;
    text-align: center;
    z-index: 200;
}

#dailyRewardsPanel h2 {
    margin-bottom: 15px;
}

#dailyRewardsPanel button {
    width: 200px;
}

/* Tutorial */
#tutorialPanel {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.9);
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 0 60px #00ff88;
    max-width: 500px;
    text-align: left;
    z-index: 200;
}

#tutorialPanel h2 {
    text-align: center;
    margin-bottom: 20px;
}

#tutorialPanel p {
    font-family: Arial, sans-serif;
    font-size: 16px;
    line-height: 1.5;
    margin-bottom: 15px;
}

#tutorialPanel button {
    display: block;
    margin: 20px auto 0;
    width: 150px;
}

</style>
</head>

<body>

<audio id="bgm" loop preload="auto">
  <source src="YOU CAN ASK THE FLOWERSYOU CAN ASK THE FLOWERS (HORROR MIX)(_6TMiEoJeZ9U_).m4a" type="audio/mp4">
</audio>
<audio id="chestSfx" preload="auto">
  <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAo" type="audio/wav">
</audio>

<div id="topBar">
    <div class="stats">üí∞ Para: <span id="money">0</span></div>
    <div class="stats">‚ö° G√º√ß: <span id="power">0</span></div>
    <div class="stats">üåå Rebirth Lv: <span id="rebirthLevel">0</span> | Nebula: <span id="nebulaPoints">0</span></div>
    <div class="stats" id="equippedInfo">Takƒ±lƒ±: Yok</div>

    <div style="display:flex; gap:12px; flex-wrap:wrap; justify-content:center;">
        <button id="chestBtn1" class="pulse" onclick="buyChests(1)">üóùÔ∏è Sandƒ±k x1 (100)</button>
        <button id="chestBtn10" class="pulse" onclick="buyChests(10)">x10 (900)</button>
    </div>

    <button onclick="toggleMusic()">üéµ M√ºzik</button>
    <button onclick="doRebirth()">üîÑ Rebirth</button>
    <button onclick="resetGame()">üíÄ Sƒ±fƒ±rla</button>
    <button onclick="claimDailyReward()">üìÖ G√ºnl√ºk √ñd√ºl</button>
</div>

<div id="tabs">
    <button class="tabButton active" data-tab="inventory">üëπ Envanter</button>
    <button class="tabButton" data-tab="shop">üõí Maƒüaza</button>
    <button class="tabButton" data-tab="rebirthShop">‚≠ê Rebirth Shop</button>
    <button class="tabButton" data-tab="achievements">üèÜ Ba≈üarƒ±lar</button>
    <button class="tabButton" data-tab="boss">üëπ Boss</button>
</div>

<div id="content">
    <div id="inventoryPanel" class="tabContent panel active">
        <h2>üëπ Lanetli Envanter</h2>
        <div id="inventoryList"></div>
    </div>

    <div id="shopPanel" class="tabContent panel">
        <h2>üõí Karanlƒ±k Maƒüaza</h2>
        <div id="shopList"></div>
    </div>

    <div id="rebirthShopPanel" class="tabContent panel">
        <h2>‚≠ê Rebirth Maƒüazasƒ± (Nebula Puanƒ± ile)</h2>
        <div id="rebirthShopList"></div>
    </div>

    <div id="achievementsPanel" class="tabContent panel">
        <h2>üèÜ Ba≈üarƒ±lar</h2>
        <div id="achievementsList"></div>
    </div>

    <div id="bossPanel" class="tabContent panel">
        <h2>üëπ Boss Sava≈üƒ±</h2>
        <div>Boss HP: <span id="bossHP">0</span> / <span id="bossMaxHP">1000</span></div>
        <div class="progressBar"><div id="bossProgressBar" class="progressFill" style="width:0%"></div></div>
        <div>ƒ∞lerleme: <span id="bossProgress">0</span>%</div>
        <button id="bossBtn" onclick="attackBoss()" disabled>‚öîÔ∏è Saldƒ±r (Hasar: <span id="bossAttack">0</span>)</button>
        <div id="bossReward"></div>
    </div>
</div>

<!-- Tutorial Panel -->
<div id="tutorialPanel">
    <h2>Ho≈ü Geldin Nebula Idle'a!</h2>
    <p>Bu oyun bir idle RPG, g√º√ß topla, item'lar y√ºkselt, rebirth yap!</p>
    <p>1. Sandƒ±k a√ß para ile item al (100 para).</p>
    <p>2. Item'larƒ± tak, g√º√ß artsƒ±n, pasif para kazan.</p>
    <p>3. Item y√ºkselt/sat, envanter y√∂net.</p>
    <p>4. G√º√ß topla, rebirth yap Nebula puan kazan (kalƒ±cƒ± boost).</p>
    <p>5. Shop'ta para ile, Rebirth Shop'ta Nebula ile upgrade al.</p>
    <p>6. Boss yen, achievement tamamla √∂d√ºl kazan.</p>
    <p>7. G√ºnl√ºk √∂d√ºl al, offline para biriksin.</p>
    <p>Eƒülen, arka planda bƒ±rak √ßalƒ±≈üsƒ±n!</p>
    <button onclick="closeTutorial()">Tamam, Oyna!</button>
</div>

<!-- G√ºnl√ºk √ñd√ºl Panel -->
<div id="dailyRewardsPanel">
    <h2>üìÖ G√ºnl√ºk √ñd√ºl</h2>
    <p id="dailyMessage"></p>
    <button onclick="closeDailyPanel()">Tamam</button>
</div>

<script>
/* GLOBAL DATA */
let money = 1000;
let inventory = [];
let equipped = {weapon: null, armor: null, boots: null, ring: null, amulet: null};
let nebulaPoints = 0;
let rebirthLevel = 0;
let rebirthUpgrades = {}; 
let achievements = [];
let musicOn = false;
let lastSaveTime = Date.now();
let boss = {hp: 1000, maxHP: 1000, progress: 0, defeated: false};
let gameMultipliers = {power: 1, income: 1, mythicChance: 0, bossDamage: 1, offlineMult: 1, sellMult: 1, upgradeCostReduction: 1, extraChestDrop: 0, rarityBoost: 0};
let autoChestTimer = 0;
let totalChestsOpened = 0;
let bossDefeatCount = 0;
let lastDailyClaim = 0; // Unix timestamp

/* CONSTANTS */
const types = ['weapon', 'armor', 'boots', 'ring', 'amulet'];
const typeNames = {weapon: 'Silah', armor: 'Zƒ±rh', boots: 'Bot', ring: 'Y√ºz√ºk', amulet: 'Tƒ±lsƒ±m'};
const itemNames = {
    common: {weapon:["Paslƒ± Bƒ±√ßak","Kƒ±rƒ±k Kƒ±lƒ±√ß","√á√ºr√ºk Mƒ±zrak"], armor:["Kirli Kalkan","Yƒ±rtƒ±k Zƒ±rh"], boots:["√áamur Bot"], ring:["Ta≈ü Y√ºz√ºk"], amulet:["K√º√ß√ºk Tƒ±lsƒ±m"]},
    rare: {weapon:["G√∂lge Han√ßer","Kanlƒ± Kƒ±lƒ±√ß"], armor:["Demir Kalkan"], boots:["Gece Adƒ±m"], ring:["B√ºy√º Halkasƒ±"], amulet:["G√∂lge Tƒ±lsƒ±m"]},
    epic: {weapon:["Ejder Bƒ±√ßaƒüƒ±","Cehennem Kƒ±lƒ±cƒ±"], armor:["Titan Kalkan"], boots:["U√ßan G√∂lge"], ring:["Ejder M√ºcevheri"], amulet:["≈ûeytan Tƒ±lsƒ±mƒ±"]},
    legendary: {weapon:["Ebedi Kƒ±lƒ±√ß","Yƒ±ldƒ±z Han√ßeri"], armor:["Abyss Kalkan"], boots:["I≈üƒ±k Hƒ±zƒ±"], ring:["Nebula M√ºcevher"], amulet:["Kozmik Tƒ±lsƒ±m"]},
    mythic: {weapon:["Kƒ±yamet Kƒ±lƒ±cƒ±","Tanrƒ± Han√ßeri"], armor:["√ñl√ºms√ºz Kalkan"], boots:["Zaman Yolcusu"], ring:["Tanrƒ± M√ºcevheri"], amulet:["Evren Tƒ±lsƒ±mƒ±"]}
};

/* REBIRTH UPGRADES */
const rebirthUpgradesList = [
    {id:1, name:"+1% Kalƒ±cƒ± G√º√ß Multi", desc:"G√ºc√ºn√º kalƒ±cƒ± olarak %1 artƒ±rƒ±r (toplamda %100'e kadar).", cost:15, max:100, effect:"power", value:0.01},
    {id:2, name:"+0.2x Pasif Gelir Hƒ±z", desc:"Pasif para kazanma hƒ±zƒ±nƒ± artƒ±rƒ±r.", cost:25, max:50, effect:"income", value:0.2},
    {id:3, name:"+0.5% Mythic ≈ûans", desc:"Mythic item √ßƒ±kma ≈üansƒ±nƒ± y√ºkseltir.", cost:40, max:20, effect:"mythicChance", value:0.005},
    {id:4, name:"Auto Sandƒ±k (5dk'da 1)", desc:"Her 5 dakikada otomatik sandƒ±k a√ßar.", cost:100, max:1, effect:"autoChest", value:1},
    {id:5, name:"5. Slot: Tƒ±lsƒ±m Unlock", desc:"Ekstra equip slotu a√ßar (Tƒ±lsƒ±m).", cost:200, max:1, effect:"extraSlot", value:1},
    {id:6, name:"Auto Upgrade (10dk'da Lv+1)", desc:"Takƒ±lƒ± item'larƒ± otomatik y√ºkseltir.", cost:150, max:1, effect:"autoUpgrade", value:1},
    {id:7, name:"+0.5x Boss Hasar Multi", desc:"Boss'a verilen hasarƒ± artƒ±rƒ±r.", cost:30, max:30, effect:"bossDamage", value:0.5},
    {id:8, name:"+0.1x Offline Para Multi", desc:"Offline para kazancƒ±nƒ± y√ºkseltir.", cost:20, max:40, effect:"offlineMult", value:0.1},
    {id:9, name:"+0.2x Satƒ±≈ü Para Multi", desc:"Item satƒ±≈üƒ±ndan daha fazla para kazandƒ±rƒ±r.", cost:35, max:25, effect:"sellMult", value:0.2},
    {id:10, name="-1% Upgrade Maliyet Azalt", desc:"Item y√ºkseltme maliyetini d√º≈ü√ºr√ºr.", cost:50, max:15, effect:"upgradeCostReduction", value:0.01},
    {id:11, name="+1 Sandƒ±k Drop (x10 Alƒ±nca)", desc:"x10 sandƒ±k alƒ±nca ekstra sandƒ±k verir.", cost:80, max:10, effect:"extraChestDrop", value:1},
    {id:12, name:"Rarity Boost (Common -> Rare %2)", desc:"Genel rarity ≈üansƒ±nƒ± kaydƒ±rƒ±r (daha iyi item'lar).", cost:60, max:20, effect:"rarityBoost", value:0.02}
];

/* SHOP ITEMS (Para ile) */
const shopItems = [
    {id:1, name:"Garantili Rare x5", cost:2500, action:()=>buyChests(5, "rare")},
    {id:2, name:"Epic Booster (+10 Nebula)", cost:5000, action:()=>{nebulaPoints+=10;}},
    {id:3, name:"Hƒ±zlƒ± Para (+10k)", cost:15000, action:()=>{money+=10000;}}
];

/* ACHIEVEMENTS - Birs√ºr√º Eklendi! */
const achievementsList = [
    {id:1, name:"ƒ∞lk Kan", desc:"1 Sandƒ±k a√ß", reward:{money:500}, check:()=>totalChestsOpened>=1},
    {id:2, name:"Sandƒ±k Ustasƒ±", desc:"50 Sandƒ±k a√ß", reward:{nebula:5}, check:()=>totalChestsOpened>=50},
    {id:3, name:"Legend Avcƒ±sƒ±", desc:"10 Legendary item topla", reward:{money:5000}, check:()=>inventory.filter(i=>i.rarity==='legendary').length>=10},
    {id:4, name:"Mythic Efendisi", desc:"1 Mythic item topla", reward:{money:25000}, check:()=>inventory.filter(i=>i.rarity==='mythic').length>=1},
    {id:5, name:"Rebirth Ba≈ülatƒ±cƒ±", desc:"1 Rebirth yap", reward:{nebula:10}, check:()=>rebirthLevel>=1},
    {id:6, name:"Rebirth Ustasƒ±", desc:"5 Rebirth yap", reward:{nebula:50}, check:()=>rebirthLevel>=5},
    {id:7, name:"Rebirth Tanrƒ±sƒ±", desc:"10 Rebirth yap", reward:{nebula:100}, check:()=>rebirthLevel>=10},
    {id:8, name:"Boss Katili", desc:"1 Boss yen", reward:{money:10000}, check:()=>bossDefeatCount>=1},
    {id:9, name:"Boss Yokedici", desc:"5 Boss yen", reward:{money:100000}, check:()=>bossDefeatCount>=5},
    {id:10, name:"Boss ƒ∞mparatoru", desc:"20 Boss yen", reward:{nebula:200}, check:()=>bossDefeatCount>=20},
    {id:11, name:"Upgrade Manyaƒüƒ±", desc:"Item'larƒ± 50 kez y√ºkselt", reward:{money:20000}, check:()=>inventory.reduce((sum, i)=>sum + i.level - 1, 0)>=50},
    {id:12, name:"Satƒ±≈ü Kralƒ±", desc:"50 Item sat", reward:{nebula:20}, check:()=>totalSoldItems>=50}, // Ek variable ÌïÑÏöî
    {id:13, name:"G√ºnl√ºk Sadƒ±k", desc:"3 G√ºn √ºst √ºste √∂d√ºl al", reward:{money:50000}, check:()=>dailyStreak>=3},
    {id:14, name:"Offline Zengin", desc:"Offline 1M para kazan", reward:{nebula:30}, check:()=>totalOfflineMoney>=1000000}, // Ek variable
    {id:15, name:"Shop Harcamacƒ±sƒ±", desc:"Maƒüazadan 10 alƒ±≈üveri≈ü yap", reward:{money:100000}, check:()=>totalShopPurchases>=10}, // Ek variable
    {id:16, name:"Rebirth Shop Kralƒ±", desc:"10 Rebirth upgrade al", reward:{nebula:100}, check:()=>Object.values(rebirthUpgrades).reduce((a,b)=>a+b,0)>=10},
    {id:17, name:"Max Power", desc:"G√º√ß 100k'ya ula≈ü", reward:{nebula:50}, check:()=>getTotalPower()>=100000},
    {id:18, name:"Full Equip", desc:"T√ºm slot'larƒ± doldur", reward:{money:20000}, check:()=>Object.values(equipped).every(id=>id!=null)},
    {id:19, name:"Mythic Koleksiyoncusu", desc:"5 Mythic item topla", reward:{nebula:100}, check:()=>inventory.filter(i=>i.rarity==='mythic').length>=5},
    {id:20, name:"Idle Master", desc:"Oyun 24 saat offline kalsƒ±n", reward:{money:500000}, check:()=>offlineSec>=86400}
];

/* LOAD/SAVE */
function loadGame(){
    const save = JSON.parse(localStorage.getItem("nebulaUltimateV5"));
    if(save){
        money = save.money || 1000;
        inventory = save.inventory || [];
        equipped = save.equipped || {};
        nebulaPoints = save.nebulaPoints || 0;
        rebirthLevel = save.rebirthLevel || 0;
        rebirthUpgrades = save.rebirthUpgrades || {};
        achievements = save.achievements || [];
        lastSaveTime = save.lastSaveTime || Date.now();
        totalChestsOpened = save.totalChestsOpened || 0;
        bossDefeatCount = save.bossDefeatCount || 0;
        lastDailyClaim = save.lastDailyClaim || 0;
        dailyStreak = save.dailyStreak || 0;
        totalSoldItems = save.totalSoldItems || 0;
        totalOfflineMoney = save.totalOfflineMoney || 0;
        totalShopPurchases = save.totalShopPurchases || 0;
        // Apply upgrades
        applyRebirthUpgrades();
        // Offline
        const offlineSec = Math.floor((Date.now() - lastSaveTime)/1000);
        const offlineMoney = Math.floor(getTotalPower() * offlineSec / 4 * gameMultipliers.income * gameMultipliers.offlineMult);
        money += Math.max(0, offlineMoney);
        totalOfflineMoney += offlineMoney;
        checkAchievements();
    } else {
        achievements = achievementsList.map(a=>({...a, achieved:false}));
    }
    initBoss();
    showTutorial();
}

function saveGame(){
    localStorage.setItem("nebulaUltimateV5", JSON.stringify({
        money, inventory, equipped, nebulaPoints, rebirthLevel, rebirthUpgrades, 
        achievements, lastSaveTime: Date.now(), totalChestsOpened, bossDefeatCount,
        lastDailyClaim, dailyStreak, totalSoldItems, totalOfflineMoney, totalShopPurchases
    }));
}

/* RARITY ROLL, RAND, GENERATE ITEM, BUY CHESTS, EQUIP, SELL, UPGRADE, POWER, PASSIVE, AUTO FEATURES, REBIRTH, BUY REBIRTH UPGRADE, BOSS, ATTACK BOSS, INIT BOSS, CHECK ACHIEVEMENTS, RENDER, RENDER LIST, RENDER INVENTORY ITEM, RENDER SHOP ITEM, RENDER REBIRTH ITEM, CREATE BTN, SHAKE UI, PLAY CHEST SFX, SWITCH TAB, RESET GAME, TOGGLE MUSIC - √ñnceki kodlardan kopyala, deƒüi≈üiklik yok. */

let totalSoldItems = 0;
let totalOfflineMoney = 0;
let totalShopPurchases = 0;
let dailyStreak = 0;

/* G√úNL√úK √ñD√úL */
function claimDailyReward(){
    const now = Date.now();
    const dayMs = 86400000; // 24 saat
    if(now - lastDailyClaim < dayMs){
        document.getElementById("dailyMessage").innerText = "G√ºnl√ºk √∂d√ºl zaten alƒ±ndƒ±! Yarƒ±n gel.";
    } else {
        const streakBonus = dailyStreak * 100;
        const reward = 1000 + streakBonus;
        money += reward;
        dailyStreak++;
        lastDailyClaim = now;
        document.getElementById("dailyMessage").innerText = `G√ºnl√ºk √∂d√ºl: ${reward} para! Streak: ${dailyStreak}`;
        checkAchievements();
        saveGame();
    }
    document.getElementById("dailyRewardsPanel").style.display = "block";
}

function closeDailyPanel(){
    document.getElementById("dailyRewardsPanel").style.display = "none";
}

/* TUTORIAL */
function showTutorial(){
    if(!localStorage.getItem("tutorialSeen")){
        document.getElementById("tutorialPanel").style.display = "block";
        localStorage.setItem("tutorialSeen", "true");
    }
}

function closeTutorial(){
    document.getElementById("tutorialPanel").style.display = "none";
}

/* INIT */
loadGame();
render();
setInterval(passiveIncome, 1000);
setInterval(saveGame, 25000);
setInterval(render, 1500);

// PWA
if('serviceWorker' in navigator) navigator.serviceWorker.register('data:text/javascript;base64,...'); // Stub
</script>

</body>
</html>